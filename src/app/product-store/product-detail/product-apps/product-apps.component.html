<div *ngIf="productDetails$ | async as details" class="m-3">
  <p-fieldset
    *ngIf="details.microfrontends && details.microfrontends.length > 0"
    [toggleable]="false"
    [collapsed]="false"
    styleClass="surface-100 py-0 mx-0"
  >
    <ng-template pTemplate="header">
      <span [pTooltip]="'DIALOG.COMPONENTS.TOOLTIPS.MFE' | translate" tooltipPosition="top" tooltipEvent="hover">
        {{ 'DIALOG.COMPONENTS.MFE' | translate }}
      </span>
    </ng-template>
    <div class="flex flex-row flex-wrap column-gap-4 row-gap-3">
      <ng-container *ngFor="let mfe of details.microfrontends.sort(sortMfesByTypeAndExposedModule)">
        <a
          class="card relative m-0 py-2 px-6 flex flex-column justify-content-center hover:bg-gray-200 hover:text-color cursor-pointer"
          (click)="onDetail($event, mfe, AppType.MFE)"
        >
          <a
            *ngIf="hasCreatePermission"
            [id]="'product_detail_components_mfe_' + mfe.appId + '_copy_app'"
            class="card-badge-left badge-1 pi pi-copy pseudo-button-link"
            (click)="onCopy($event, mfe, AppType.MFE)"
            [pTooltip]="'ACTIONS.COPY.LABEL' | translate"
            tooltipPosition="top"
            tooltipEvent="hover"
          ></a>
          <a
            *ngIf="hasDeletePermission"
            [id]="'product_detail_components_mfe_' + mfe.appId + '_delete'"
            class="card-badge-left badge-2 p-2 pi pi-trash danger-action-text pseudo-button-link"
            (click)="onDelete($event, mfe, AppType.MFE)"
            [pTooltip]="'ACTIONS.DELETE.LABEL' | translate"
            tooltipPosition="top"
            tooltipEvent="hover"
          ></a>
          <span
            *ngIf="mfe?.undeployed"
            [id]="'product_detail_components_mfe_' + mfe.appId + '_undeployed'"
            class="card-badge-right badge-1 pi pi-ban danger-action-text font-bold cursor-auto"
            [pTooltip]="'APP.TOOLTIPS.UNDEPLOYED_SEARCH' | translate"
            tooltipPosition="top"
            tooltipEvent="hover"
          ></span>
          <span
            *ngIf="mfe?.deprecated && !mfe?.undeployed"
            [id]="'product_detail_components_mfe_' + mfe.appId + '_deprecated'"
            class="card-badge-right badge-1 pi pi-exclamation-circle danger-action-text font-bold cursor-auto"
            [pTooltip]="'APP.TOOLTIPS.DEPRECATED_SEARCH' | translate"
            tooltipPosition="top"
            tooltipEvent="hover"
          ></span>
          <span
            [id]="'product_detail_components_mfe_' + mfe.appId + '_icon'"
            class="card-badge-right badge-2 p-2 pi cursor-auto"
            [ngClass]="'pi-' + mfe.iconName"
            [pTooltip]="'Icon'"
            tooltipPosition="top"
            tooltipEvent="hover"
          ></span>
          <div class="w-12rem flex flex-column justify-content-between gap-1 text-center">
            <div
              class="font-bold white-space-nowrap"
              [pTooltip]="mfe.appId.length <= 25 ? '' : mfe.appId"
              tooltipPosition="top"
              tooltipEvent="hover"
            >
              {{ limitText(mfe.appId, 25) }}
            </div>
            <div class="text-xs">{{ mfe.type }}</div>
            <div
              class="text-sm"
              [pTooltip]="mfe.exposedModule && mfe.exposedModule.length <= 25 ? '' : (mfe.exposedModule ?? '')"
              tooltipPosition="top"
              tooltipEvent="hover"
            >
              {{ limitText(mfe.exposedModule ?? '', 25) }}
            </div>
          </div>
        </a>
      </ng-container>
    </div>
  </p-fieldset>

  <p-fieldset
    *ngIf="details.microservices && details.microservices.length > 0"
    [toggleable]="false"
    [collapsed]="false"
    styleClass="surface-100 py-0 mx-0 mt-3"
  >
    <ng-template pTemplate="header">
      <span [pTooltip]="'DIALOG.COMPONENTS.TOOLTIPS.MS' | translate" tooltipPosition="top" tooltipEvent="hover">
        {{ 'DIALOG.COMPONENTS.MS' | translate }}
      </span>
    </ng-template>
    <div class="flex flex-row flex-wrap column-gap-4 row-gap-3">
      <ng-container *ngFor="let ms of details.microservices.sort(sortMssByAppId)">
        <a
          class="card relative m-0 py-2 px-6 flex flex-column justify-content-center hover:bg-gray-200 hover:text-color cursor-pointer"
          (click)="onDetail($event, ms, AppType.MS)"
        >
          <a
            *ngIf="hasCreatePermission"
            tabindex="0"
            [id]="'product_detail_components_ms_' + ms.appId + '_copy_app'"
            class="card-badge-left badge-1 pi pi-copy pseudo-button-link"
            (click)="onCopy($event, ms, AppType.MS)"
            [pTooltip]="'ACTIONS.COPY.LABEL' | translate"
            tooltipPosition="top"
            tooltipEvent="hover"
          ></a>
          <a
            *ngIf="hasDeletePermission"
            tabindex="0"
            [id]="'product_detail_components_ms_' + ms.appId + '_delete'"
            class="card-badge-left badge-2-1 p-2 pi pi-trash danger-action-text pseudo-button-link"
            (click)="onDelete($event, ms, AppType.MS)"
            [pTooltip]="'ACTIONS.DELETE.LABEL' | translate"
            tooltipPosition="top"
            tooltipEvent="hover"
          ></a>
          <span
            *ngIf="ms?.undeployed"
            [id]="'product_detail_components_ms_' + ms.appId + '_undeployed'"
            class="card-badge-right badge-1 pi pi-ban danger-action-text font-bold cursor-auto"
            [pTooltip]="'APP.TOOLTIPS.UNDEPLOYED_SEARCH' | translate"
            tooltipPosition="top"
            tooltipEvent="hover"
          ></span>
          <div class="h-2-5rem w-12rem flex flex-column justify-content-around text-center">
            <div
              class="font-bold white-space-nowrap"
              [pTooltip]="ms.appId && ms.appId.length <= 25 ? '' : (ms.appId ?? '')"
              tooltipPosition="top"
              tooltipEvent="hover"
            >
              {{ limitText(ms.appId, 25) }}
            </div>
          </div>
        </a>
      </ng-container>
    </div>
  </p-fieldset>

  <p-fieldset
    *ngIf="details.slots && details.slots.length > 0"
    [toggleable]="false"
    [collapsed]="false"
    styleClass="surface-100 py-0 mx-0 mt-3"
  >
    <ng-template pTemplate="header">
      <span [pTooltip]="'DIALOG.COMPONENTS.TOOLTIPS.SLOT' | translate" tooltipPosition="top" tooltipEvent="hover">
        {{ 'DIALOG.COMPONENTS.SLOT' | translate }}
      </span>
    </ng-template>
    <div class="flex flex-row flex-wrap column-gap-4 row-gap-3">
      <ng-container *ngFor="let slot of details.slots.sort(sortSlotsByName)">
        <div class="card relative m-0 py-0 px-0 flex flex-column justify-content-center">
          <a
            *ngIf="hasDeletePermission"
            tabindex="0"
            [id]="'product_detail_components_slot_' + slot.appId + '_delete'"
            class="card-badge-left badge-2-1 p-2 pi pi-trash danger-action-text pseudo-button-link"
            (click)="onSlotDelete($event, slot)"
            [pTooltip]="'ACTIONS.DELETE.LABEL' | translate"
            tooltipPosition="top"
            tooltipEvent="hover"
          ></a>
          <span
            *ngIf="slot?.undeployed"
            [id]="'product_detail_components_slot_' + slot.name + '_undeployed'"
            class="card-badge-right badge-1 pi pi-ban danger-action-text cursor-auto"
            [pTooltip]="'APP.TOOLTIPS.UNDEPLOYED_SEARCH' | translate"
            tooltipPosition="top"
            tooltipEvent="hover"
          ></span>
          <span
            *ngIf="slot?.deprecated && !slot?.undeployed"
            [id]="'product_detail_components_slot_' + slot.appId + '_deprecated'"
            class="card-badge-right badge-1 pi pi-exclamation-circle danger-action-text cursor-auto"
            [pTooltip]="'APP.TOOLTIPS.DEPRECATED_SEARCH' | translate"
            tooltipPosition="top"
            tooltipEvent="hover"
          ></span>
          <div class="h-2-5rem w-12rem my-2 mx-6 flex flex-column justify-content-around text-center">
            <div
              class="font-bold white-space-nowrap"
              [pTooltip]="slot.name.length <= 25 ? '' : slot.name"
              tooltipPosition="top"
              tooltipEvent="hover"
            >
              {{ limitText(slot.name, 25) }}
            </div>
          </div>
        </div>
      </ng-container>
    </div>
  </p-fieldset>
</div>

<app-app-detail
  [displayDialog]="displayDetailDialog"
  [appAbstract]="app"
  [changeMode]="changeMode"
  (appChanged)="appChanged($event)"
></app-app-detail>

<app-app-delete
  [displayDialog]="displayDeleteDialog"
  [appAbstract]="app"
  (appDeleted)="appDeleted($event)"
></app-app-delete>

<app-slot-delete
  [displayDialog]="displaySlotDeleteDialog"
  [slot]="slot"
  (slotDeleted)="slotDeleted($event)"
></app-slot-delete>
